<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Deals - API Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            color: #555;
            margin-top: 0;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .log {
            background: #000;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Campus Deals API Connectivity Test</h1>
        
        <div class="test-section">
            <h3>üöÄ Quick Tests</h3>
            <button onclick="testServerHealth()">Test Server Health</button>
            <button onclick="testCORS()">Test CORS</button>
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div class="test-section">
            <h3>üîê Authentication Tests</h3>
            <div class="form-group">
                <h4>Register New User</h4>
                <label>Name:</label>
                <input type="text" id="regName" value="Test User" />
                
                <label>Email:</label>
                <input type="email" id="regEmail" value="" />
                
                <label>Password:</label>
                <input type="password" id="regPassword" value="TestPassword123!" />
                
                <label>Phone:</label>
                <input type="text" id="regPhone" value="1234567890" />
                
                <label>College:</label>
                <input type="text" id="regCollege" value="Test College" />
                
                <button onclick="testRegister()">Test Register</button>
            </div>
            
            <div class="form-group">
                <h4>Login User</h4>
                <label>Email:</label>
                <input type="email" id="loginEmail" value="syamaladevi1221@gmail.com" />
                
                <label>Password:</label>
                <input type="password" id="loginPassword" value="Syamala@122" />
                
                <button onclick="testLogin()">Test Login</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä Test Results</h3>
            <div id="status"></div>
            <div id="log" class="log">Ready to run tests...\n</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('log');
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üîç';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function setStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }
        
        function clearLog() {
            document.getElementById('log').textContent = 'Log cleared...\n';
            document.getElementById('status').textContent = '';
        }
        
        // Generate random email for testing
        document.getElementById('regEmail').value = `test${Date.now()}@example.com`;
        
        async function makeRequest(name, url, options = {}) {
            log(`Testing: ${name}`);
            log(`URL: ${url}`);
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                let data;
                try {
                    data = await response.json();
                } catch (e) {
                    data = await response.text();
                }
                
                if (response.ok) {
                    log(`SUCCESS: ${response.status} ${response.statusText}`, 'success');
                    log(`Response: ${JSON.stringify(data, null, 2)}`);
                    return { success: true, data, status: response.status };
                } else {
                    log(`FAILED: ${response.status} ${response.statusText}`, 'error');
                    log(`Error Response: ${JSON.stringify(data, null, 2)}`, 'error');
                    return { success: false, data, status: response.status };
                }
            } catch (error) {
                log(`NETWORK ERROR: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }
        
        async function testServerHealth() {
            setStatus('Testing server health...', 'info');
            const result = await makeRequest('Server Health', `${API_BASE}/health`);
            
            if (result.success) {
                setStatus('‚úÖ Server is running and healthy!', 'success');
            } else {
                setStatus('‚ùå Server health check failed', 'error');
            }
        }
        
        async function testCORS() {
            setStatus('Testing CORS...', 'info');
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'OPTIONS'
                });
                log(`CORS Preflight: ${response.status} ${response.statusText}`);
                
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                log(`CORS Headers: ${JSON.stringify(headers, null, 2)}`);
                
                setStatus('‚úÖ CORS test completed', 'success');
            } catch (error) {
                log(`CORS Error: ${error.message}`, 'error');
                setStatus('‚ùå CORS test failed', 'error');
            }
        }
        
        async function testRegister() {
            setStatus('Testing user registration...', 'info');
            
            const userData = {
                user_name: document.getElementById('regName').value,
                user_email: document.getElementById('regEmail').value,
                user_password: document.getElementById('regPassword').value,
                user_phone: document.getElementById('regPhone').value,
                user_college: document.getElementById('regCollege').value
            };
            
            const result = await makeRequest('User Registration', `${API_BASE}/auth/register`, {
                method: 'POST',
                body: JSON.stringify(userData)
            });
            
            if (result.success) {
                setStatus('‚úÖ Registration successful!', 'success');
                // Update login form with registered email
                document.getElementById('loginEmail').value = userData.user_email;
                document.getElementById('loginPassword').value = userData.user_password;
            } else {
                setStatus('‚ùå Registration failed', 'error');
            }
        }
        
        async function testLogin() {
            setStatus('Testing user login...', 'info');
            
            const loginData = {
                user_email: document.getElementById('loginEmail').value,
                user_password: document.getElementById('loginPassword').value
            };
            
            const result = await makeRequest('User Login', `${API_BASE}/auth/login`, {
                method: 'POST',
                body: JSON.stringify(loginData)
            });
            
            if (result.success) {
                setStatus('‚úÖ Login successful!', 'success');
                if (result.data.token) {
                    log('üîë Token received: ' + result.data.token.substring(0, 50) + '...', 'success');
                }
            } else {
                setStatus('‚ùå Login failed', 'error');
            }
        }
        
        async function runAllTests() {
            setStatus('Running comprehensive tests...', 'info');
            clearLog();
            
            log('üöÄ Starting comprehensive API tests...');
            log('='.repeat(50));
            
            // Test 1: Server Health
            await testServerHealth();
            
            // Test 2: CORS
            await testCORS();
            
            // Test 3: Register
            log('\nüìù Testing Registration...');
            await testRegister();
            
            // Test 4: Login
            log('\nüîê Testing Login...');
            await testLogin();
            
            // Test 5: Network diagnostics
            log('\nüåê Network Diagnostics...');
            try {
                const startTime = Date.now();
                const response = await fetch(`${API_BASE}/health`);
                const endTime = Date.now();
                log(`Response Time: ${endTime - startTime}ms`);
                
                if (navigator.connection) {
                    log(`Connection Type: ${navigator.connection.effectiveType}`);
                    log(`Downlink: ${navigator.connection.downlink} Mbps`);
                }
            } catch (error) {
                log(`Network diagnostic error: ${error.message}`, 'error');
            }
            
            log('\n' + '='.repeat(50));
            log('üèÅ All tests completed!');
            setStatus('üèÅ All tests completed! Check the log for details.', 'info');
        }
        
        // Auto-run health check on page load
        window.onload = function() {
            log('üåü API Test Page Loaded');
            log('Click "Test Server Health" to verify backend connection');
            testServerHealth();
        };
    </script>
</body>
</html>